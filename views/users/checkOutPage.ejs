<%- include('../layouts/header') %>
<!--====== Main App ======-->
<div id="app">
    
    
    <!--====== App Content ======-->
    <div class="app-content">
        
        <!--====== Section 1 ======-->
        <div class="u-s-p-y-60">
            
            <!--====== Section Content ======-->
            <div class="section__content">
                <div class="container">
                    <div class="breadcrumb">
                        
                    </div>
                </div>
            </div>
        </div>
        <!--====== End - Section 1 ======-->
        
        
        <form action="/placeOrder" method="post">
            <!--====== Section 2 ======-->
            <div class="u-s-p-b-60">

                <!--====== Section Content ======-->
                <div class="section__content">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-12">
                                <div id="checkout-msg-group">

                                    <div class="msg">

                                        <span class="msg__text">Have a coupon?

                                            <a class="gl-link" href="#have-coupon" data-toggle="collapse">Click Here to
                                                search for coupon</a></span>
                                        <div class="collapse" id="have-coupon" data-parent="#checkout-msg-group">
                                            <div class="c-f u-s-m-b-16">

                                                <span class="gl-text u-s-m-b-16">Enter your coupon code if you have
                                                    one.</span>
                                                <div class="u-s-m-b-16">
                                                    <div class="u-s-m-b-15">
                                                        <label for="coupon"></label>

                                                        <select class="input-text input-text--primary-style" id="coupon"
                                                            name="coupon" placeholder="Coupon Code">
                                                            <% for( let key of coupons){%>
                                                                <option value="<%-key._id%>"><%-key.name%></option>
                                                                <%}%>
                                                        </select>
                                                    </div>
                                                    <div class="u-s-m-b-15">

                                                        <button type="button" class="btn btn--e-transparent-brand-b-2"
                                                            onclick="apply()">APPLY</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--====== End - Section Content ======-->
            </div>
            <!--====== End - Section 2 ======-->


            <!--====== Section 3 ======-->
            <div class="u-s-p-b-60">

                <!--====== Section Content ======-->
                    <div class="section__content">
                        <div class="container">
                            <div class="checkout-f">
                                <div class="row">
                                    
                                    <div class="col-lg-12">
                                        <h1 class="checkout-f__h1">ORDER SUMMARY</h1>

                                        <!--====== Order Summary ======-->
                                        <div class="o-summary">
                                            <div class="o-summary__section u-s-m-b-30">
                                                <div class="o-summary__item-wrap gl-scroll">
                                                    <% for(let key of products.item){ %>
                                                        <div class="o-card">
                                                            <div class="o-card__flex">
                                                                <div class="o-card__img-wrap">

                                                                    <img class="u-img-fluid"
                                                                        src="/admin/uploads/<%=key.productId.image[0] %>" alt="">
                                                                </div>
                                                                <div class="o-card__info-wrap">

                                                                    <span class="o-card__name">

                                                                        <a
                                                                            href="/productDetail?id=<%-key.productId._id%>">
                                                                            <%= key.productId.name %>
                                                                        </a></span>

                                                                    <span class="o-card__quantity">Quantity x <%=
                                                                            key.qty %></span>

                                                                    <span class="o-card__price">$<%= key.productId.price
                                                                            %>.00</span>
                                                                </div>
                                                            </div>

                                                            <span class="o-card__quantity text-dark">Quantity x <%=
                                                                    key.qty %></span>
                                                        </div>
                                                        <%}%>
                                                </div>
                                            </div>
                                            <!-- <div class="o-summary__section u-s-m-b-30">
                                            <div class="o-summary__box">
                                                <h1 class="checkout-f__h1">SHIPPING & BILLING</h1>
                                                <div class="ship-b">

                                                    <span class="ship-b__text">Ship to:</span>
                                                    <div class="ship-b__box u-s-m-b-10">
                                                        <p class="ship-b__p">4247 Ashford Drive Virginia VA-20006 USA (+0) 900901904</p>

                                                        <a class="ship-b__edit btn--e-transparent-platinum-b-2" data-modal="modal" data-modal-id="#edit-ship-address">Edit</a>
                                                    </div>
                                                    <div class="ship-b__box">

                                                        <span class="ship-b__text">Bill to default billing address</span>

                                                        <a class="ship-b__edit btn--e-transparent-platinum-b-2" data-modal="modal" data-modal-id="#edit-ship-address">Edit</a></div>
                                                </div>
                                            </div>
                                             </div> -->
                                            <div class="o-summary__section u-s-m-b-30">
                                                <div class="o-summary__box">
                                                    <table class="o-summary__table">
                                                        <tbody>
                                                            <tr>
                                                                <td>SHIPPING</td>
                                                                <td>$4.00</td>
                                                            </tr>
                                                            <tr>
                                                                <td>TAX</td>
                                                                <td>$0.00</td>
                                                            </tr>
                                                            <tr>
                                                                <td>SUBTOTAL</td>
                                                                <td>₹.<%= products.totalPrice %>.00</td>
                                                                <input type="hidden" value="<%= products.totalPrice %>"
                                                                    id="subTotal" />
                                                            </tr>
                                                            <tr id="dis">

                                                            </tr>
                                                            <tr id="amt">

                                                            </tr>
                                                            <tr id="gT">
                                                                <td>GRAND TOTAL</td>
                                                                <td>₹.<%= products.totalPrice %>.00</td>
                                                                <input type="hidden" value="<%= products.totalPrice %>"
                                                                    name="amount" />
                                                            </tr>
                                                </div>
                                                </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        <div class="o-summary__section u-s-m-b-30">
                                            <div class="o-summary__box">
                                                <h1 class="checkout-f__h1">PAYMENT INFORMATION</h1>
                                                <div class="u-s-m-b-10">
                                                    <div class="radio-box">

                                                        <input type="radio" id="pay-pal" name="payment">
                                                        <div class="radio-box__state radio-box__state--primary">

                                                            <label class="radio-box__label" for="pay-pal">Razor Pay</label>
                                                        </div>
                                                    </div>
                                                    <!--====== End - Radio Box ======-->

                                                    <span class="gl-text u-s-m-t-6">When you click "Place Order" below
                                                        we'll take you to Paypal's site to set up your billing
                                                        information.</span>
                                                    <!--====== Radio Box ======-->
                                                    <!-- <div class="radio-box">

                                                        <input value="COD" type="radio" id="cash-on-delivery"
                                                            name="payment" checked>
                                                        <div class="radio-box__state radio-box__state--primary">

                                                            <label class="radio-box__label" for="cash-on-delivery">Cash
                                                                on Delivery</label>
                                                                
                                                        </div>
                                                    </div> -->


                                                    
                                                    <!--====== End - Radio Box ======-->

                                                    <span class="gl-text u-s-m-t-6">Pay Upon Cash on delivery. (This
                                                        service is only available for some countries)</span>
                                                </div>
                                                <div class="u-s-p-b-60">

                                                    <!--====== Section Content ======-->
                                                    <div class="section__content">
                                                        <div class="container">
                                                            <div class="row">
                                                                <div class="col-lg-12">
                                                                    <div id="checkout-msg-group">
                                    
                                                                        <div class="msg">
                                    
                                                                            <span class="msg__text">Cash on Delivery?
                                    
                                                                                <a class="gl-link" href="#have-coupon" data-toggle="collapse">Click Here
                                                                                    </a></span>
                                                                            <div class="collapse" id="have-coupon" data-parent="#checkout-msg-group">
                                                                                <div class="c-f u-s-m-b-16">
                                    
                                                                                    <span class="gl-text u-s-m-b-16">
                                                                                        </span>
                                                                                    <div class="u-s-m-b-16">
                                                                                        <div class="u-s-m-b-15">
                                                                                            <div class="col-lg-12">
                                                                                                <h1 class="checkout-f__h1">DELIVERY INFORMATION</h1>
                                                                                                
                                                                                                <div class="u-s-m-b-30">
                                                                                                    
                                                                                                                <!--====== First Name, Last Name ======-->
                                                                                                                <div class="gl-inline">
                                                                                                                    <div class="u-s-m-b-15">
                                                        
                                                                                                                        <label class="gl-label" for="billing-fname">FIRST NAME
                                                                                                                            *</label>
                                                        
                                                                                                                        <input class="input-text input-text--primary-style"
                                                                                                                            type="text" id="billing-fname" name="firstname"
                                                                                                                            data-bill="">
                                                                                                                    </div>
                                                                                                                    <div class="u-s-m-b-15">
                                                        
                                                                                                                        <label class="gl-label" for="billing-lname">LAST NAME
                                                                                                                            *</label>
                                                        
                                                                                                                        <input class="input-text input-text--primary-style"
                                                                                                                            type="text" id="billing-lname" name="lastname"
                                                                                                                            data-bill="">
                                                                                                                    </div>
                                                                                                                </div>
                                                        
                                                                                                                <!--====== Street Address ======-->
                                                                                                                <div class="u-s-m-b-15">
                                                        
                                                                                                                    <label class="gl-label" for="billing-street">STREET ADDRESS
                                                                                                                        *</label>
                                                        
                                                                                                                    <input class="input-text input-text--primary-style"
                                                                                                                        type="text" id="billing-street" name="street"
                                                                                                                        placeholder="House name and street name" data-bill="">
                                                                                                                </div>
                                                        
                                                                                                                
                                                                                                                <!--====== End - Country ======-->
                                                        
                                                        
                                                                                                                <!--====== Town / City ======-->
                                                                                                                <div class="u-s-m-b-15">
                                                        
                                                                                                                    <label class="gl-label" for="billing-town-city">TOWN/CITY
                                                                                                                        *</label>
                                                        
                                                                                                                    <input class="input-text input-text--primary-style"
                                                                                                                        type="text" name="city" id="billing-town-city"
                                                                                                                        data-bill="">
                                                                                                                </div>
                                                        
                                                                                                                <!--====== ZIP/POSTAL ======-->
                                                                                                                <div class="u-s-m-b-15">
                                                        
                                                                                                                    <label class="gl-label" for="billing-zip">PIN CODE
                                                                                                                        *</label>
                                                        
                                                                                                                    <input class="input-text input-text--primary-style"
                                                                                                                        type="text" id="billing-zip"
                                                                                                                        placeholder="Zip/Postal Code" name="pin" data-bill="">
                                                                                                                </div>
                                                                                                                <!--====== End - ZIP/POSTAL ======-->
                                                                                                                <!--====== PHONE ======-->
                                                                                                                <div class="u-s-m-b-15">
                                                        
                                                                                                                    <label class="gl-label" for="billing-phone">PHONE *</label>
                                                        
                                                                                                                    <input class="input-text input-text--primary-style"
                                                                                                                        type="number" name="mno" id="billing-phone"
                                                                                                                        data-bill="">
                                                                                                                </div>
                                                                                                                <!--====== End - PHONE ======-->
                                                                                                                <div class="u-s-m-b-10">
                                                        
                                                                                                                    <!--====== Check Box ======-->
                                                                                                                <!-- <button class=" btn--e-transparent-brand-b-2" type="submit">SAVE</button></div> -->
                                                        
                                                                                                                    <button type="submit" style="background-color: orangered;color: white;">submit</button>
                                                                                                                      <!-- <a href="" class="class="btn btn--e-transparent-brand-b-2"">  save</a> -->
                                                                                                                    <!--====== End - Check Box ======-->
                                                                                                                </div>
                                                                                                </div>
                                                                                        
                                                                                            </div>
                                                                                            <h3>saved address</h3>


                                                                                            
                                                                                                
                                                                                                       
                                                                                      
                                                                                        </div>
                                                                                        
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <!--====== End - Section Content ======-->
                                                </div>
                                                
                                                    <!--====== Radio Box ======-->
                                                    
                                                </div>

                                                
                                            </div>
                                        </div>
                                    </div>
                                    <!--====== End - Order Summary ======-->
                                </div>
                            </div>
                        </div>
                    </div>
            </div>
            </form>
            <div>
                <a href="/successCashOnDelivery" class="btn btn--e-brand-b-2 btn-outline-warning btn-sm" style="margin-left: 15%;">Place Order</a>
                    <!-- <button class="btn btn--e-brand-b-2 btn-outline-warning btn-sm"
                        type="submit">PLACE ORDER</button> -->
                </div>
            <!--====== End - Section Content ======-->
        </div>
        <!--====== End - Section 3 ======-->
    </div>
    <!--====== End - App Content ======-->



    <!--====== Modal Section ======-->


    <!--====== Shipping Address Add Modal ======-->
   
    <!--====== End - Shipping Address Add Modal ======-->


    <!--====== Shipping Address Add Modal ======-->
    
    <!--====== End - Shipping Address Add Modal ======-->
    <!--====== End - Modal Section ======-->
    </div>

    <script src="js/vendor.js"></script>

    <!--====== jQuery Shopnav plugin ======-->
    <script src="js/jquery.shopnav.js"></script>

    <!--====== App ======-->
    <script src="js/app.js"></script>

    <script>
        function apply() {
            cop = document.getElementById('coupon').value
            subT = document.getElementById('subTotal').value
            $.ajax({
                url: '/applyCoupon',
                type: 'POST',
                data: { id: cop },
                success: function (data) {
                    

                    if(subT<=data.couponData.max&&subT>=data.couponData.min){
                        total = subT-data.couponData.discount;
                    console.log(total);
                    console.log(subT);
                
                    console.log(data.couponData.discount);
                    subTotalCalc=subT/4;
                    totalFinal=subT-subTotalCalc
                    document.getElementById('dis').innerHTML = `
                    <td>COUPON DISCOUNT</td>
                    <td>${subTotalCalc} </td>`
                    
                    document.getElementById('gT').innerHTML = `    
                    <td>GRAND TOTAL</td>
                    <td>₹ ${totalFinal}.00</td>
                    <input type="hidden" value="${totalFinal}" name="amount" />`
                    console.log(totalFinal);

                    }
                    else{
                        console.log("koppp");
                    }
                  }
            
                
            });

        }


    </script>


    <%- include ('../layouts/footer.ejs') %>